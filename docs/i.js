let t=new AudioContext;const s={t:'"Courier New", monospace',i:"Arial, sans-serif",h:'"Times New Roman", serif',o:60,l:"js13k 2025: Black Cat",get w(){return Math.round(s.M.u.width/s.M.scale)},get m(){return Math.round(s.M.u.height/s.M.scale)},init(){s.p.init(),s.M.init(),s.M.level=new s._,s.M.v()},T(t){for(let s=t.length-1;s>0;s--){const i=Math.floor(Math.random()*(s+1));[t[s],t[i]]=[t[i],t[s]]}}};window.addEventListener("load",()=>s.init()),s.M={u:null,P:null,level:null,cursor:[-1,-1],k:!1,C:0,I:0,A:[0,0],offset:[0,0],scale:1,clear(){this.P.setTransform(1,0,0,1,0,0),this.P.clearRect(0,0,this.u.width,this.u.height)},draw(){this.clear(),this.P.setTransform(this.scale,0,0,this.scale,0,0),this.level?.draw(this.P)},F(){this.P.setTransform(this.scale,0,0,this.scale,0,0),this.P.fillStyle="#0006",this.P.fillRect(0,0,this.u.width/this.scale,this.u.height/this.scale),this.P.fillStyle="#fff",this.P.font="600 56px "+s.i,this.P.textAlign="center",this.P.textBaseline="top",this.P.fillText("PAWSED",this.A.x,this.A.y-56)},O(t,s){const i=document.createElement("canvas");i.width=t,i.height=s;const h=i.getContext("2d",{alpha:!0});return h.lineCap="round",h.lineJoin="round",[i,h]},S(){return[this.cursor[0]/this.scale,this.cursor[1]/this.scale]},init(){[this.u,this.P]=this.O(),document.body.append(this.u),this.H(),this.resize()},v(t=0){if(t&&this.C){const i=(t-this.C)/(1e3/s.o);if(this.k)return void this.F();this.I+=i,this.level.update(i),this.draw(),this.P.fillStyle="#fff",this.P.font="600 12px "+s.t,this.P.textAlign="left",this.P.fillText(String(Math.round(s.o/i)).padStart(3,"0")+" FPS, "+this.scale.toFixed(5),10,20)}this.C=t,requestAnimationFrame(t=>this.v(t))},pause(){this.k=!0},H(){window.addEventListener("resize",t=>this.resize()),this.resize(),s.p.W("Escape",()=>this.B());let t=null;this.u.addEventListener("mouseleave",t=>{this.cursor[0]=-1}),this.u.addEventListener("mousemove",s=>{this.cursor[0]=s.clientX-this.offset[0],this.cursor[1]=s.clientY-this.offset[1],t||this.k||(t=setTimeout(()=>{this.level?.D(this.S()),t=null},66))}),this.u.addEventListener("click",t=>{this.cursor[0]=t.clientX-this.offset[0],this.cursor[1]=t.clientY-this.offset[1],this.k||this.level?.N(this.S())})},resize(){const t=1920/1080;let s=window.innerHeight,i=Math.round(s*t);i>window.innerWidth&&(i=window.innerWidth,s=i/t),this.scale=s/1080,this.A.x=i/2/this.scale,this.A.y=s/2/this.scale,this.offset[0]=(window.innerWidth-i)/2,this.offset[1]=(window.innerHeight-s)/2,this.u.width=i,this.u.height=s,this.k&&(clearTimeout(this.R),this.R=setTimeout(()=>this.F(),100))},B(){this.k?this.unpause():this.pause()},unpause(){this.k&&(this.k=!1,this.v())}},s.Audio={context:new AudioContext,async play(s,i){if(s instanceof Uint8Array){const t=await this.context.decodeAudioData(s.buffer.slice()),h=this.context.createGain();h.connect(this.context.destination),h.gain.value=i||.5;const e=this.context.createBufferSource();e.buffer=t,e.connect(h),e.loop=!1,e.start()}else s[0]=i||s[0],((s=1,i=.05,h=220,e=0,n=0,o=.1,a=0,r=1,f=0,l=0,c=0,d=0,u=0,M=0,w=0,m=0,g=0,p=1,y=0,b=0,x=0)=>{let _=Math,v=2*_.PI,T=44100,P=f*=500*v/T/T,k=h*=(1-i+2*i*_.random(i=[]))*v/T,C=0,I=0,A=0,F=1,O=0,S=0,E=0,H=x<0?-1:1,W=v*H*x*2/T,B=_.cos(W),D=_.sin,N=D(W)/4,R=1+N,G=-2*B/R,$=(1-N)/R,K=(1+H*B)/2/R,L=-(H+B)/R,U=K,z=0,J=0,X=0,Y=0;for(l*=500*v/T**3,w*=v/T,c*=v/T,d*=T,u=T*u|0,s*=.3,H=(e=T*e+9)+(y*=T)+(n*=T)+(o*=T)+(g*=T)|0;A<H;i[A++]=E*s)++S%(100*m|0)||(E=a?1<a?2<a?3<a?D(C**3):_.max(_.min(_.tan(C),1),-1):1-(2*C/v%2+2)%2:1-4*_.abs(_.round(C/v)-C/v):D(C),E=(u?1-b+b*D(v*A/u):1)*(E<0?-1:1)*_.abs(E)**r*(A<e?A/e:A<e+y?1-(A-e)/y*(1-p):A<e+y+n?p:A<H-g?(H-A-g)/o*p:0),E=g?E/2+(g>A?0:(A<H-g?1:(H-A)/g)*i[A-g|0]/2/s):E,x&&(E=Y=U*z+L*(z=J)+K*(J=E)-$*X-G*(X=Y))),W=(h+=f+=l)*_.cos(w*I++),C+=W+W*M*D(A**5),F&&++F>d&&(h+=c,k+=c,F=0),!u||++O%u||(h=k,f=P,F=F||1);(s=t.createBuffer(1,H,T)).getChannelData(0).set(i),(h=t.createBufferSource()).buffer=s,h.connect(t.destination),h.start()})(...s)},G:[.1,0,92,.02,,.05,,,,,-80,-.01,.01,-.1,,,,.6,.03,.05,-1188],drop:[.2,0,414,.02,.03,.08,,1.3,,160,,,,.4,,,,.67,,,279],$:{"-1":[.2,0,102,,.05,.12,2,1.3,,1,,,.02,.9,,,,.6,.03,.27],0:[.2,0,303,.02,.04,.04,,.3,,-3,,,.01,,5.7,,,.53,.02],1:[.2,0,345,.02,.02,.16,1,.9,,,349,.05,,,,,,.74,.03]},K:new Uint8Array([255,243,132,196,0,0,0,0,0,0,0,0,0,88,105,110,103,0,0,0,15,0,0,0,26,0,0,3,192,0,8,8,8,16,16,16,16,32,32,32,32,40,40,40,40,56,56,56,56,72,72,72,72,80,80,80,96,96,96,96,104,104,104,104,120,120,120,120,136,136,136,136,144,144,144,144,152,152,152,160,160,160,160,168,168,168,168,176,176,176,176,184,184,184,184,192,192,192,192,200,200,200,200,208,208,208,216,216,216,216,224,224,224,224,232,232,232,232,240,240,240,240,248,248,248,248,255,255,255,0,0,0,57,76,65,77,69,51,46,49,48,48,2,30,0,0,0,0,0,0,0,0,20,8,36,3,200,34,0,0,8,0,0,3,192,229,212,162,251,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,243,20,196,0,2,128,6,80,0,0,132,0,88,62,250,4,255,229,63,63,254,32,201,255,243,20,196,1,2,168,190,152,0,0,68,160,7,22,70,255,255,169,133,167,252,186,111,255,243,36,196,1,6,49,30,160,40,3,206,193,7,200,74,210,255,55,255,246,83,197,64,32,35,27,9,13,255,253,88,108,53,27,158,94,56,0,48,81,127,252,249,205,216,193,49,255,243,20,196,11,5,96,202,188,0,1,88,200,48,63,16,203,108,245,12,1,144,104,202,255,243,36,196,0,6,57,6,180,0,1,218,177,231,158,32,5,234,233,255,247,112,120,36,3,192,128,64,0,176,36,83,255,234,156,70,254,55,96,64,36,3,132,153,127,144,210,127,255,243,36,196,10,6,73,14,216,120,0,76,173,245,66,87,155,9,175,255,255,133,230,230,214,145,193,185,42,106,210,37,3,182,73,5,156,241,185,46,114,155,86,95,175,52,51,255,255,243,20,196,19,6,80,206,208,120,3,78,167,240,200,193,142,38,185,170,12,82,128,100,255,243,36,196,4,6,8,210,180,88,3,94,206,241,74,153,53,15,255,208,122,81,132,232,127,190,62,29,5,187,158,33,10,213,12,67,224,98,168,63,101,109,255,245,59,50,73,7,255,243,20,196,14,6,17,34,164,88,3,68,209,65,58,127,164,253,31,138,28,88,118,213,255,243,36,196,0,6,25,34,180,88,3,78,195,28,194,128,86,62,129,206,112,93,191,254,170,62,97,200,4,136,127,111,111,83,134,195,97,74,8,143,12,59,224,186,140,214,70,154,255,243,36,196,10,5,216,210,144,80,4,222,204,127,254,203,69,42,5,50,39,28,176,38,77,242,85,38,29,195,214,182,255,255,240,80,70,196,144,79,95,255,255,128,53,42,168,58,255,243,20,196,21,2,128,206,168,32,3,88,204,20,191,255,255,145,125,85,12,102,7,138,255,243,20,196,22,2,8,206,176,0,1,210,204,127,255,250,145,136,200,149,136,128,5,255,255,243,20,196,24,2,8,206,176,0,3,86,204,255,245,97,18,136,2,183,255,255,226,234,255,243,20,196,26,2,144,202,176,32,2,146,204,12,33,66,255,255,255,168,138,68,51,224,255,243,20,196,26,1,248,202,192,0,1,76,204,102,253,127,255,241,172,33,127,255,254,153,255,243,20,196,29,1,144,198,200,0,1,68,192,60,253,6,134,244,2,40,47,235,255,254,255,243,20,196,33,1,224,198,196,40,1,68,192,161,24,183,255,179,47,175,84,66,42,70,255,243,20,196,36,3,233,38,148,0,4,26,192,96,224,45,255,203,152,255,213,8,197,191,255,243,20,196,31,4,137,38,220,120,1,198,214,255,254,64,226,85,71,14,36,239,252,87,255,243,20,196,23,2,56,102,200,48,0,12,20,254,177,85,216,66,191,253,110,79,223,44,255,243,20,196,25,1,208,190,180,0,1,196,192,40,255,43,135,127,239,254,68,147,4,85,255,243,20,196,28,2,32,94,184,8,0,4,18,22,255,226,194,226,191,138,138,11,126,42,255,243,20,196,30,2,56,94,148,0,0,68,160,76,65,77,69,51,46,49,48,48,170,170,255,243,20,196,32,2,88,2,140,0,0,0,0,170,170,170,170,170,170,170,170,170,170,170,255,243,20,196,33,2,184,1,204,0,8,0,0,170,170,170,170,170,170,170,170,170,170,170])},s.p={L:{},U:{},J:{},init(){document.body.onkeydown=t=>{const s=this.J[t.code];s&&s.X||(this.J[t.code]={time:Date.now()},this.L[t.code]&&this.L[t.code].forEach(t=>t()))},document.body.onkeyup=t=>{this.J[t.code]={time:0},this.U[t.code]&&this.U[t.code].forEach(t=>t())}},Y(t,s){for(const i of t)if(this.j(i,s))return!0;return!1},j(t,s){const i=this.J[t];return!(!i||!i.time)&&(s&&(i.time=0,i.X=!0),!0)},q(t,s){const i=this.L[t]||[];i.push(s),this.L[t]=i},W(t,s){const i=this.U[t]||[];i.push(s),this.U[t]=i}},s.V=class{constructor(t,s=0){this.level=t,this.set(s)}Z(){return this.level.I>this.timeEnd}tt(){return Math.min(1,1-(this.timeEnd-this.level.I)/this.duration)}set(t){this.duration=t*s.o,this.timeEnd=this.level.I+this.duration}},s.st=class{it=!0;constructor(t,i,h){this.level=t,this.w=i,this.m=h,[this.u,this.P]=s.M.O(i,h)}ht(){return(s.w-this.w)/2}draw(t){}update(t){}},s.Animation=class{constructor(t,i,h){this.I=new s.V(s.M.level,t),this.et=i,this.nt=h}ot(t){this.I&&(this.I.Z()?(this.nt(this),this.I=null):this.et(this.I.tt(),t))}},s.rt=class{static ft=1;static lt=2;static ct=3;constructor(t,s,i,h=100,e=100){this.id=t,this.x=s,this.y=i,this.w=h,this.m=e}draw(t){if(!this.u)if([this.u,this.P]=s.M.O(this.w,this.m),this.id==s.rt.ft)this.P.fillStyle="#ff0",this.P.beginPath(),this.P.roundRect(2,2,this.w-4,this.m-4,20),this.P.fill(),this.P.fillStyle="#000",this.P.font="600 20px "+s.i,this.P.textAlign="center",this.P.textBaseline="middle",this.P.fillText("Open Shop!",this.w/2,this.m/2);else if(this.P.fillStyle="#000",this.P.strokeStyle="#fff",this.P.lineWidth=3,this.P.beginPath(),this.P.arc(this.w/2,this.m/2,this.w/2-2,0,2*Math.PI),this.P.fill(),this.P.stroke(),this.id==s.rt.lt){const t=this.w/3;this.P.fillStyle="#1e61ad",this.P.beginPath(),this.P.moveTo(t-10,50),this.P.lineTo(2*t+6,50),this.P.lineTo(t+7,this.m-18),this.P.lineTo(t-16,this.m-40),this.P.closePath(),this.P.fill(),this.P.save(),this.P.translate(this.w/2,this.m/2),this.P.rotate(45*Math.PI/180),this.P.translate(-this.w/2,-this.m/2),this.P.beginPath(),this.P.moveTo(t,this.m-20),this.P.lineTo(2*t,this.m-20),this.P.lineTo(2*t,35),this.P.lineTo(1.7*t,35),this.P.lineTo(1.7*t,15),this.P.lineTo(1.3*t,15),this.P.lineTo(1.3*t,35),this.P.lineTo(t,35),this.P.closePath(),this.P.fillStyle="#ffffff3f",this.P.fill(),this.P.stroke(),this.P.fillStyle="#70430f",this.P.fillRect(1.3*t+1.5,9,.4*t-3,12),this.P.restore()}else this.id==s.rt.ct&&(this.P.beginPath(),this.P.arc(this.w/2,this.m/2,this.w/2-25,.75*Math.PI,1.5*Math.PI),this.P.moveTo(this.w/2-8,15),this.P.lineTo(this.w/2+2,25),this.P.lineTo(this.w/2-8,35),this.P.stroke(),this.P.beginPath(),this.P.arc(this.w/2,this.m/2,this.w/2-25,1.75*Math.PI,Math.PI/2),this.P.moveTo(this.w/2+8,this.m-15),this.P.lineTo(this.w/2-2,this.m-25),this.P.lineTo(this.w/2+8,this.m-35),this.P.stroke());let i=null;this.id==s.rt.ft?this.x=(s.w-this.w)/2:this.id==s.rt.lt?(this.x=s.w/2+410,this.y=530,i="Finish Potion"):this.id==s.rt.ct&&(this.x=(s.w-100)/2,this.y=s.m/2+280,i="Pour Away"),t.globalAlpha=this.id==s.rt.ft||this.dt?1:.6,t.drawImage(this.u,this.x,this.y),t.globalAlpha=1,this.dt&&s._.ut(t,i,this.x+this.w/2,this.y+this.m+10)}},s._=class{constructor(){this.I=0,this.Mt=30,this.wt=10,this.gt=!1,this.yt=!1,this.bt=[],this.xt=-1,this._t=[],this.vt=[],this.Tt=[],this.Pt=null,this.kt=[],this.Ct=new s.rt(s.rt.ft,0,390,200,40),this.It=new s.rt(s.rt.lt),this.At=new s.rt(s.rt.ct),this.Ft=new s.Ot(this),this.St=new s.Et(this),this.Ht=new s.Wt(this),this.Bt(0)}Dt(t){this.It.draw(t),this.At.draw(t)}Nt(t){if(!this.Rt){[this.Rt,this.Gt]=s.M.O(700,320),this.Gt.fillStyle="#ffffff0f";const t=[155,120,90,70,50,40];let i=0;this.Gt.beginPath();for(let s=0;s<t.length;s++){const h=t[s];this.Gt.arc(i+h,320-h,h,0,2*Math.PI),this.Gt.closePath(),i+=1.25*h}this.Gt.fill()}const i=10*Math.sin(this.I/60)-20,h=s.m-320+40;t.drawImage(this.Rt,i,h),t.drawImage(this.Rt,i-215,h+10);const e=s.M.scale,n=s.w-700-i;t.setTransform(-e,0,0,e,e*(n+700),e*h),t.drawImage(this.Rt,0,0),t.drawImage(this.Rt,-155,10),t.setTransform(e,0,0,e,0,0)}$t(t){t.fillStyle="#0000004f",t.fillRect(0,0,s.w,s.m);const i=600,h=(s.w-i)/2;t.fillStyle="#000",t.strokeStyle="#f00",t.lineWidth=2,t.shadowColor="#700",t.shadowBlur=100,t.beginPath(),t.roundRect(h,200,i,125,4),t.fill(),t.stroke(),t.shadowBlur=0,t.fillStyle="#fff",t.textAlign="center",t.textBaseline="top",t.font="500 28px "+s.i,t.fillText("Shop's closed (◞ ᆺ ◟)",h+300,230),t.font="500 20px "+s.i,t.fillText("There were too many complaints.",h+300,280)}Kt(t){t.fillStyle="#683f24",t.fillRect(80,580,420,25);for(let s=0;s<this.kt.length;s++){this.kt[s].draw(t,this.I)}}Lt(t){t.fillStyle="#0000004f",t.fillRect(0,0,s.w,s.m);const i=640,h=(s.w-i)/2;t.fillStyle="#000",t.strokeStyle="#ff0",t.lineWidth=2,t.shadowColor="#770",t.shadowBlur=100,t.beginPath(),t.roundRect(h,200,i,256,4),t.fill(),t.stroke(),t.shadowBlur=0,t.fillStyle="#fff",t.textAlign="center",t.textBaseline="top",t.font="italic 600 28px "+s.i,t.fillText("Welcome to Black Cat Potions!",h+320,230),t.font="500 20px "+s.i,t.fillText("Figure out what your customer wants, then create a",h+320,280),t.fillText("potion for them with the ingredients on the left.",h+320,310),t.fillText("You are only allowed a certain number of mistakes total.",h+320,350),this.Ct.draw(t)}Ut(t){if(!this.Pt)return;const i=this.Pt,h=i.I.tt(),e=i.zt.tt(),n=i.Jt,o=i.Xt.split("\n"),a="number"==typeof i.$,r=s.M.scale;let f=350,l=100+24*o.length,c=s.w-390*Math.sqrt(a?1:e),d=400;if(a){const h=s.w-175-40,n=400+l/2-160*e,o={"-1":"#f00",0:"#fff",1:"#ff0"};t.globalAlpha=1-e*e,t.lineCap="round",t.lineWidth=10,t.fillStyle=t.strokeStyle=o[i.$.toString()],t.beginPath(),t.arc(h-30,n,10,0,2*Math.PI),t.arc(h+30,n,10,0,2*Math.PI),t.fill(),t.beginPath(),t.arc(h,n+30,80,0,2*Math.PI),t.stroke(),1==i.$?(t.beginPath(),t.ellipse(h,n+45,35,20,0,0,Math.PI),t.stroke()):-1==i.$?(t.beginPath(),t.ellipse(h,n+60,35,20,0,Math.PI,0),t.stroke()):0==i.$&&(t.beginPath(),t.moveTo(h-35,n+50),t.lineTo(h+35,n+50),t.stroke()),t.globalAlpha=1,d+=(s.m-390)*e*e;const a=d+l/2;t.translate(c,a),t.rotate(10*Math.PI/180),t.translate(-c,-a)}t.fillStyle="#000",t.strokeStyle="#ff0",t.lineWidth=2,t.beginPath(),t.roundRect(c,d,f,l,4),t.fill(),t.stroke(),t.fillStyle="#ff0",t.beginPath(),t.roundRect(c,d,Math.max(1,f*(1-h)),20,[4,0,0]),t.fill(),t.fillStyle="#fff",t.textAlign="left",t.font="italic 600 22px "+s.h;for(let s=0;s<o.length;s++){const i=o[s];t.fillText(i,c+20,d+40),d+=26}n.kt.length>0&&n.kt.length<4&&(t.font="500 18px "+s.i,t.fillText("Ingredients: "+n.kt.length,c+20,d+60)),t.setTransform(r,0,0,r,0,0)}Yt(t){t.strokeStyle="#ff0",t.textAlign="right",t.textBaseline="top",t.font="600 18px "+s.t;const i=354,h=s.w-i-40;let e=60;const n=Math.min(1,this.vt.length/this.Mt);t.fillStyle="#ff0",t.lineWidth=3,t.beginPath(),t.roundRect(h,e,i,30,4),t.fill(),t.fillText("Done "+this.vt.length+"/"+this.Mt,h+i,e+36),t.fillStyle="#6a267a",t.beginPath(),t.roundRect(h+3,e+3,Math.max(6,i*n-6),24,4),t.fill();const o=Math.min(1,this.Tt.length/this.wt);e=150,t.fillStyle="#ff0",t.lineWidth=3,t.beginPath(),t.roundRect(h,e,i,30,4),t.fill(),t.fillText("Wrong "+this.Tt.length+"/"+this.wt,h+i,e+36),t.fillStyle="#f00",t.beginPath(),t.roundRect(h+3,e+3,Math.max(6,i*o-6),24,4),t.fill()}jt(t){const i=[];let h=75;return t<2?(i.push(s.Qt.qt,s.Qt.Vt,s.Qt.Zt,s.Qt.ts),s.T(i)):2==t?(h=55,i.push(s.Qt.qt,s.Qt.Vt,s.Qt.Zt,s.Qt.ts,s.Qt.ss,s.Qt.hs,s.Qt.es,s.Qt.ns,s.Qt.ns),s.T(i),i.splice(0,0,s.Qt.ss)):t>2&&(h=55,i.push(s.Qt.qt,s.Qt.Vt,s.Qt.Zt,s.Qt.ts,s.Qt.ss,s.Qt.hs,s.Qt.es,s.Qt.ns,s.Qt.rs,s.Qt.fs,s.Qt.fs,s.Qt.ls,s.Qt.cs,s.Qt.ds,s.Qt.ds,s.Qt.us),s.T(i),i.splice(0,0,s.Qt.ls),i.splice(0,0,s.Qt.rs)),i.map(t=>({Jt:t,Ms:h}))}ws(t){this.Ht.gs(t)}Bt(t){this.xt!=t&&(this.xt=t,this.kt=[s.ps,s.ys],t>=2&&this.kt.push(s.bs),t>=3&&this.kt.push(s.xs),t>0&&(this._t=this.jt(t),this._s()))}draw(t){this.Nt(t),this.Ft.draw(t),this.Ht.draw(t),this.St.draw(t),this.Kt(t),this.Yt(t),this.yt?this.$t(t):(this.Ut(t),this.Dt(t),0==this.xt&&this.Lt(t),this.bt.forEach(t=>t.ot()),this.vs?.ot({P:t}))}static ut(t,i,h,e){t.save();const n=18*i.length;t.filter="blur(20px)",t.fillStyle="#000",t.fillRect(h-n/2,e,n,32),t.filter="blur(0)",t.fillStyle="#fff",t.font="italic 600 32px "+s.h,t.textAlign="center",t.textBaseline="top",t.fillText(i,h,e),t.restore()}Ts(t){if(!t)return null;const i=t.length;if(0==i)return s.Qt.qt;for(const h in s.Qt){const e=s.Qt[h];if(e.kt.length!=i)continue;let n=0;for(const s of e.kt)t.includes(s)&&n++;if(n==i)return e}return null}Ps(t,s){return t[0]>=s.x&&t[0]<=s.x+s.w&&t[1]>=s.y&&t[1]<=s.y+s.m}_s(){this.Pt=this._t.splice(0,1)[0];let t=this.Pt.Ms;this.xt>2&&(t=Math.max(5,t-this.vt.length));const i=Math.round(Math.random()*(this.Pt.Jt.Xt.length-1));this.Pt.Xt=this.Pt.Jt.Xt[i],this.Pt.I=new s.V(this,t),this.Pt.zt=new s.V(this,.7)}N(t){if(!this.ks)if(0!=this.xt){if(this.Ps(t,this.It))return this.Cs(this.Ht.Is),void this.Ht.As([]);if(this.Ps(t,this.At))this.Ht.As([]);else for(let s=0;s<this.kt.length;s++){const i=this.kt[s];if(this.Ps(t,i))return void this.ws(i)}}else this.Ps(t,this.Ct)&&(this.Bt(1),setTimeout(()=>s.Audio.play(s.Audio.K),10))}D(t){if(0==this.xt||this.yt)return;this.It.dt=!1,this.At.dt=!1;let s=!1;for(let i=0;i<this.kt.length;i++){const h=this.kt[i];h.dt=!1,!s&&this.Ps(t,h)&&(s=!0,h.dt=!0)}!s&&this.Ps(t,this.It)&&(s=!0,this.It.dt=!0),!s&&this.Ps(t,this.At)&&(s=!0,this.At.dt=!0)}Fs(t){if(!t)return-1;if(this.Pt.Jt==t)return 1;return(this.Pt.Jt.Os||[]).includes(t)?0:-1}update(t){this.I+=t;const i=this.vt.length;if(!this.gt&&i==this.Mt)return this.gt=!0,setTimeout(()=>s.Audio.play(s.Audio.K),2e3),void(this.vs=new s.Animation(12,(t,i)=>{const h=400,e=150;let n=(s.w-h)/2,o=140;if(t<.2){let s=t/.2;o=-e+Math.sqrt(s)*(e+o)}else if(t>.8){let s=(1-t)/.2;o=s*s*(e+o)-e}i.P.fillStyle="#000",i.P.strokeStyle="#ff0",i.P.lineWidth=2,i.P.shadowColor="#770",i.P.shadowBlur=100,i.P.beginPath(),i.P.roundRect(n,o,h,e,4),i.P.fill(),i.P.stroke(),i.P.shadowBlur=0,i.P.fillStyle="#ff0",i.P.font="italic 600 28px "+s.i,i.P.textAlign="center",i.P.textBaseline="top",i.P.fillText("Goal achieved",n+200,o+24),i.P.font="500 20px "+s.i,i.P.fillText("This shop really landed on its feet!",n+200,o+70),i.P.fillText("From here on it is endless mode.",n+200,o+100)},t=>{this.vs=null}));this.Tt.length>=this.wt?this.yt=!0:(this.Pt&&"number"!=typeof this.Pt.$&&this.Pt.I?.Z()&&this.Cs(),4==i?this.Bt(2):12==i&&this.Bt(3),this.Ft.update(this.I),this.Ht.update(this.I),this.St.update(this.I))}Cs(t){if(!this.Pt||"number"==typeof this.Pt.$)return;const i=this.Ts(t),h=this.Fs(i);this.Pt.$=h,this.Pt.zt.set(.75),s.Audio.play(s.Audio.$[h.toString()]),this.bt.push(new s.Animation(1,t=>{},t=>{const s=this.bt.indexOf(t);s>=0&&this.bt.splice(s,1),h>0?this.vt.push(this.Pt):h<0&&this.Tt.push(this.Pt),0==this._t.length&&(this._t=this.jt(this.xt)),this._s()}))}},s.Ot=class extends s.st{constructor(t){super(t,800,800),this.offsetY=0}Ss(t){return(this.w-t)/2}Es(t){let s=260,i=this.Ss(t)-20,h=80,e=100;this.P.fillStyle="#000",this.P.strokeStyle="#000",this.P.beginPath(),this.P.moveTo(i,s),this.P.lineTo(i+10,s-e),this.P.lineTo(i+h,s),this.P.closePath(),this.P.fill(),this.P.stroke(),this.P.beginPath(),this.P.moveTo(this.w-i,s),this.P.lineTo(this.w-i-10,s-e),this.P.lineTo(this.w-i-h,s),this.P.closePath(),this.P.fill(),this.P.stroke(),this.P.fillStyle="#111",i+=15,e-=45,h-=35,this.P.beginPath(),this.P.moveTo(i,s),this.P.lineTo(i+5,s-e),this.P.lineTo(i+h,s),this.P.fill(),this.P.beginPath(),this.P.moveTo(this.w-i,s),this.P.lineTo(this.w-i-5,s-e),this.P.lineTo(this.w-i-h,s),this.P.fill()}Hs(t){let s=this.Ss(t);const i=t/2;let h=410;this.P.strokeStyle="#000",this.P.lineWidth=6,this.P.beginPath(),this.P.moveTo(s,h),this.P.lineTo(s-100,400),this.P.moveTo(s,420),this.P.lineTo(s-100,420),this.P.moveTo(s,430),this.P.lineTo(s-100,440),this.P.moveTo(this.w-s,h),this.P.lineTo(this.w-s+100,400),this.P.moveTo(this.w-s,420),this.P.lineTo(this.w-s+100,420),this.P.moveTo(this.w-s,430),this.P.lineTo(this.w-s+100,440),this.P.stroke();this.P.strokeStyle="#aaa",this.P.lineWidth=4,this.P.beginPath(),this.P.ellipse(s+i-22,440,22,16,0,0,.9*Math.PI),this.P.stroke(),this.P.beginPath(),this.P.ellipse(s+i+22,440,22,16,0,.1*Math.PI,Math.PI),this.P.stroke();let e=380,n=40,o=30;this.P.fillStyle="#ff0",this.P.beginPath(),this.P.ellipse(s+.15*t,e,n,o,0,0,2*Math.PI),this.P.ellipse(s+.85*t,e,n,o,0,0,2*Math.PI),this.P.fill(),n=35,o=25,this.P.fillStyle="#000",this.P.beginPath(),this.P.ellipse(s+.16*t,390,n,o,0,0,2*Math.PI),this.P.ellipse(s+.84*t,390,n,o,0,0,2*Math.PI),this.P.fill()}Ws(){let t=220;this.P.fillStyle="#6a267a",this.P.beginPath(),this.P.moveTo(0,320),this.P.lineTo(150,t),this.P.lineTo(250,t),this.P.lineTo(320,20),this.P.lineTo(this.w-100,70),this.P.lineTo(this.w-300,120),this.P.lineTo(this.w-250,t),this.P.lineTo(this.w-150,t),this.P.lineTo(this.w,320),this.P.closePath(),this.P.fill(),this.P.fillStyle="#54245f",this.P.beginPath(),this.P.moveTo(240,250),this.P.lineTo(256,190),this.P.lineTo(this.w-260,190),this.P.lineTo(this.w-240,250),this.P.closePath(),this.P.fill()}Bs(){this.P.strokeStyle="#000",this.P.lineWidth=40,this.P.beginPath();const t=this.w/2,s=this.m;this.P.moveTo(t,s);const i=this.w-20,h=this.m/2+60;this.P.bezierCurveTo(t+300,s,i-200,h,i,h),this.P.stroke()}draw(t){if(this.it){this.P.clearRect(0,0,this.w,this.m);const t=.4*this.w,s=this.Ss(t);this.P.fillStyle="#000",this.P.beginPath(),this.P.fillRect(s,250,t,this.m-250),this.P.ellipse(s,this.m-420,150,15,90*Math.PI/180,0,Math.PI),this.P.ellipse(s+t,this.m-420,150,15,270*Math.PI/180,0,Math.PI),this.P.closePath(),this.P.fill(),this.Hs(t),this.Ws(),this.Es(t),this.Bs()}t.drawImage(this.u,this.ht(),s.m-this.level.Ht.m-this.m/2+this.offsetY)}update(t){t*=.05,this.offsetY=4*Math.sin(t)}},s.Et=class extends s.st{constructor(t){super(t,800,600),this.state=s.Et.Ds,this.I=0}Ns(){this.P.fillStyle="#111",this.P.beginPath(),this.P.ellipse(380,120,48,40,-20*Math.PI/180,0,2*Math.PI),this.P.ellipse(this.w-340,160,48,40,20*Math.PI/180,0,2*Math.PI),this.P.fill()}draw(t){this.it&&(this.P.clearRect(0,0,this.w,this.m),this.P.fillStyle="#534320",this.P.beginPath(),this.P.roundRect(400,0,40,340,4),this.P.fill(),this.P.beginPath(),this.P.ellipse(420,340,45,25,0,Math.PI,0),this.P.fill(),this.P.fillStyle="#42361d",this.P.beginPath(),this.P.ellipse(420,340,35,15,0,Math.PI,0),this.P.fill(),this.P.lineWidth=3,this.P.strokeStyle="#ffffff3f",this.P.beginPath(),this.P.moveTo(375,342),this.P.lineTo(465,342),this.P.stroke(),this.Ns());let i=this.level.I/40,h=this.ht()+200*Math.sin(i)-20,e=s.m-this.level.Ht.m-80+30*Math.cos(i);const n=h+this.w/2+20,o=e+this.m/2-170,a=10*Math.sin(i);t.translate(n,o),t.rotate(a*Math.PI/180),t.translate(-n,-o),t.drawImage(this.u,h,e),t.setTransform(s.M.scale,0,0,s.M.scale,0,0)}},s.Wt=class extends s.st{constructor(t){super(t,800,650),this.Is=[],this.Rs=[],[this.Gs,this.$s]=s.M.O(.72*this.w,.28*this.m)}Ks(t,s,i){const h=(this.level.I+i)/25%4;if(this.P.lineWidth=3,this.P.strokeStyle="#ffffff4f",this.P.beginPath(),h<3){const i=h/3;this.P.lineWidth*=i,this.P.arc(t,s,i*i*12,Math.PI,0)}else{const i=1-h+3;this.P.globalAlpha=i*i*i,this.P.moveTo(t,s-8),this.P.lineTo(t,s-18),this.P.moveTo(t-7,s-6),this.P.lineTo(t-15,s-13),this.P.moveTo(t+7,s-6),this.P.lineTo(t+15,s-13)}this.P.stroke(),this.P.globalAlpha=1}Ls(){const t=this.Gs.width,i=this.Gs.height,h=t/2,e=i/2;this.$s.clearRect(0,0,t,i);let n="#2d7feb";const o=this.Is.length;if(1==o)n=this.Is[0].Us;else if(o>1){const t=[[s.ys,s.ps,s.xs,s.bs],[s.ps,s.bs,s.xs],[s.ys,s.bs,s.xs],[s.ys,s.ps,s.xs],[s.ys,s.ps,s.bs],[s.ys,s.ps],[s.ys,s.bs],[s.ys,s.xs],[s.ps,s.bs],[s.ps,s.xs],[s.bs,s.xs]];let i=null;for(let s=0;s<t.length;s++){const h=t[s];let e=!0;i=[];for(let t=0;t<h.length;t++){if(!this.Is.includes(h[t])){e=!1;break}i.push(h[t].Us)}if(e)break}const h=[],e=[],o=[];if(i.forEach(t=>{h.push(parseInt(t.substring(1,3),16)),e.push(parseInt(t.substring(3,5),16)),o.push(parseInt(t.substring(5,7),16))}),this.zs??=new s.V(this.level,2),this.Js??=0,this.Xs??=1,this.zs.Z()){const t=i.length;this.Js=++this.Js%t,this.Xs=++this.Xs%t,this.zs.set(2)}const a=this.zs.tt(),r=1-a;n=`rgb(${h[this.Js]*r+h[this.Xs]*a},${e[this.Js]*r+e[this.Xs]*a},${o[this.Js]*r+o[this.Xs]*a})`}this.$s.fillStyle=n,this.$s.beginPath(),this.$s.ellipse(t/2,i/2,h,e,0,0,2*Math.PI),this.$s.fill()}gs(t){this.Is.includes(t)||(this.Rs.push(new s.Animation(2,(s,i)=>{const h=1-s;this.P.strokeStyle="#ffffff7f",this.P.lineWidth=Math.max(2,10*h),this.P.globalAlpha=h,this.P.beginPath(),this.P.ellipse(i.x,i.y-20,Math.max(.5,200*s),Math.max(.5,60*s),0,0,2*Math.PI),this.P.stroke();const e=20+100*s,n=160*((Math.sin(s*Math.PI)+1)/2)-20,o=Math.max(2,10*h);this.P.lineWidth=1,this.P.fillStyle=t.Us,this.P.beginPath(),this.P.arc(i.x-e,i.y-n,o,0,2*Math.PI),this.P.fill(),this.P.stroke(),this.P.beginPath(),this.P.arc(i.x+e,i.y-n,o,0,2*Math.PI),this.P.fill(),this.P.stroke(),this.P.globalAlpha=1},t=>{const s=this.Rs.indexOf(t);s>=0&&this.Rs.splice(s,1)})),s.Audio.play(s.Audio.drop),this.Is.push(t),this.it=!0,this.zs=null,this.Js=null,this.Xs=null)}draw(t){this.P.clearRect(0,0,this.w,this.m);const i=this.w/2,h=.2*this.m+2,e=[0,0,2*Math.PI],n=this.P.createRadialGradient(i,h+.37*this.m,.14*this.m,i,h+.37*this.m,.82*this.m);n.addColorStop(0,"#666"),n.addColorStop(1,"#444"),this.P.strokeStyle="#444",this.P.lineWidth=4,this.P.fillStyle=n,this.P.beginPath(),this.P.ellipse(i,h+.33*this.m,.5*this.w,.47*this.m,...e),this.P.fill(),this.P.beginPath(),this.P.ellipse(i,h,.45*this.w,.2*this.m,...e),this.P.fill(),this.P.stroke(),this.P.fillStyle="#444",this.P.beginPath(),this.P.ellipse(i,h-.01*this.m,.39*this.w,.15*this.m,...e),this.P.fill();let o=i/2-90,a=h-.06*this.m;this.Ls(),this.P.save(),this.P.clip(),this.P.drawImage(this.Gs,o,a),this.P.restore(),this.Ks(i-180,h+25,75),this.Ks(i-100,h+50,50),this.Ks(i-30,h+10,0),this.Ks(i+30,h+60,25),this.Ks(i+100,h+20,50),this.Ks(i+180,h+40,75),this.Rs.forEach(t=>t.ot({x:o+this.Gs.width/2,y:a+this.Gs.height/2})),t.drawImage(this.u,this.ht(),s.m-this.m+100),Math.random()<.01&&s.Audio.play(s.Audio.G,.3*Math.random())}As(t){this.Is=t,this.it=!0,this.zs=null,this.Js=null,this.Xs=null}},s.ps={name:"Fire Berries",Us:"#a81646",x:320,y:430,w:150,m:150,draw(t){if(!this.u){[this.u,this.P]=s.M.O(this.w,this.m),this.P.fillStyle="#61401a",this.P.fillRect(42,0,this.w-84,52),this.P.lineWidth=4,this.P.fillStyle="#ffffff1f",this.P.strokeStyle="#ccc",this.P.beginPath(),this.P.moveTo(2,42),this.P.lineTo(2,this.m-2),this.P.lineTo(this.w-2,this.m-2),this.P.lineTo(this.w-2,42),this.P.lineTo(this.w-40,42),this.P.lineTo(this.w-40,12),this.P.lineTo(40,12),this.P.lineTo(40,42),this.P.closePath(),this.P.fill(),this.P.stroke();const t=[[15,80],[35,90],[55,96],[75,96],[95,96],[115,90],[135,80],[15,100],[35,110],[55,116],[75,116],[95,116],[115,110],[135,100],[15,120],[35,130],[55,136],[75,136],[95,136],[115,130],[135,120],[17,136],[133,136],[25,85,.9],[50,90,.9],[80,100,.9],[105,95,.9],[130,85,.9],[20,105,.9],[40,108,.9],[63,112,.9],[98,114,.9],[120,106,.9],[22,125,.9],[42,135,.9],[67,132,.9],[85,125,.9],[110,135,.9],[135,128,.9]];for(let s=0;s<t.length;s++){const i=t[s];this.P.filter=`brightness(${i[2]||1})`,this.P.fillStyle="#a81646",this.P.beginPath(),this.P.arc(i[0],i[1],10,0,2*Math.PI),this.P.fill(),this.P.fillStyle="#ffffff17",this.P.beginPath(),this.P.arc(i[0]+4,i[1]-4,5,0,2*Math.PI),this.P.fill()}}t.drawImage(this.u,this.x,this.y),this.dt&&s._.ut(t,this.name,this.x+this.w/2,this.y+this.m+35)}},s.ys={name:"Crystal Ice",Us:"#6ebec4",x:100,y:430,w:180,m:150,Ys:[],draw(t,i){if(this.u||([this.u,this.P]=s.M.O(this.w,this.m),this.P.fillStyle=this.Us,this.P.beginPath(),this.P.ellipse(this.w/2,this.m/2+20,this.w/2-20,this.m/2-40,0,0,Math.PI,!0),this.P.fill(),this.P.fillStyle="#4d5b6e",this.P.beginPath(),this.P.ellipse(this.w/2,this.m/2+10,this.w/2,this.m/2,0,0,Math.PI),this.P.fill()),t.drawImage(this.u,this.x,this.y),0==Math.round(i%40)){const i=this.x+this.w/2+60*(2*Math.random()-1),h=this.y+this.m/2-5+15*(2*Math.random()-1);this.Ys.push(new s.Animation(1,s=>{t.globalAlpha=2*(s>.5?1-s:s),t.strokeStyle="#fff",t.lineWidth=1,t.beginPath(),t.moveTo(i-2,h),t.lineTo(i+2,h),t.moveTo(i,h-2),t.lineTo(i,h+2),t.stroke(),t.globalAlpha=1},t=>{const s=this.Ys.indexOf(t);s>=0&&this.Ys.splice(s,1)}))}this.Ys.forEach(t=>t.ot()),this.dt&&s._.ut(t,this.name,this.x+this.w/2,this.y+this.m+35)}},s.bs={name:"Dried Herbs",Us:"#007744",x:0,y:0,w:700,m:280,Ys:[],js(t,s,i,h){t.strokeStyle="#37460e",t.fillStyle="#adb639",t.lineWidth=2;for(let e=i;e<h;e+=20){let i=s,n=e/h;i-=n<.5?20*n:20*(1-n),t.beginPath(),t.moveTo(i,e),t.lineTo(i-30,e+20),t.moveTo(i,e),t.lineTo(i+30,e+20),t.stroke(),t.beginPath(),t.ellipse(i-25,e+18,5,7,Math.PI/4,0,2*Math.PI),t.ellipse(i+25,e+18,5,7,Math.PI/-4,0,2*Math.PI),t.fill()}t.strokeStyle="#305e25",t.lineWidth=4,t.beginPath(),t.moveTo(s,0),t.quadraticCurveTo(s-20,h/2,s,h),t.stroke()},draw(t,i){if(!this.u){[this.u,this.P]=s.M.O(this.w,this.m);const t=this.w/10;for(let s=1;s<11;s++){const i=t*s-40,h=s%2?-5:-15,e=this.m*(s%2?1:.8)-80+5*s;this.P.filter=`brightness(${.8+.05*s})`,this.js(this.P,i,h,e)}}if(0==Math.round(i%120)){const i=this.w/2+(2*Math.random()-1)*this.w/2,h=this.m/3;this.Ys.push(new s.Animation(10,s=>{const e=Math.sin(10*s);t.globalAlpha=1-s,t.fillStyle="#adb639",t.lineWidth=1,t.beginPath(),t.ellipse(i+10*e,h+300*s,5,7,(90+-15*e)*Math.PI/180,0,2*Math.PI),t.fill(),t.globalAlpha=1},t=>{const s=this.Ys.indexOf(t);s>=0&&this.Ys.splice(s,1)}))}this.Ys.forEach(t=>t.ot()),t.drawImage(this.u,this.x,this.y),this.dt&&s._.ut(t,this.name,this.x+this.w/2,this.y+this.m)}},s.xs={name:"Mindshrooms",Us:"#8143a5",x:0,get y(){return s.m-this.m},w:530,m:200,qs(t,s,i,h){const e=this.m-s;this.P.filter=`brightness(${h})`,this.P.fillStyle="#ddd",this.P.fillRect(t,this.m-s,i,s),this.P.fillStyle="#8143a5",this.P.beginPath(),this.P.ellipse(t+i/2,e,2*i,1.5*i,0,0,Math.PI,!0),this.P.fill()},draw(t){this.u||([this.u,this.P]=s.M.O(this.w,this.m),this.qs(0,75,25,.4),this.qs(30,130,45,.6),this.qs(100,80,30,.7),this.qs(60,40,20,.75),this.qs(225,30,25,.65),this.qs(350,20,25,.65),this.qs(150,95,30,.85),this.qs(280,70,50,.9),this.qs(410,80,30,.95),this.qs(110,30,10,1),this.qs(200,45,20,1),this.qs(320,35,20,1.1),this.qs(450,25,15,1)),t.drawImage(this.u,this.x,this.y),this.dt&&s._.ut(t,this.name,this.x+this.w/2,this.y)}},s.Qt={qt:{kt:[],Xt:["Just a water, please","I'm thirsty"]},Zt:{kt:[s.ps],Xt:["Something to warm me up","I feel so cold"]},Vt:{kt:[s.ys],Xt:["Ugh, it's so hot!","I need to cool down"],get Os(){return[s.Qt.qt]}},ts:{kt:[s.ps,s.ys],Xt:["A cold drink with hot fruits"]},ss:{kt:[s.bs],Xt:["I feel sick...","A witchy herbal tee, please"],get Os(){return[s.Qt.hs]}},ns:{kt:[s.ys,s.bs],Xt:["Just finished workout. Got\nsome refreshing energizer?","Do you have a cold\nand healthy drink?"]},hs:{kt:[s.ps,s.bs],Xt:["A health potion, but can\nyou make it tasty?"]},es:{kt:[s.ys,s.ps,s.bs],Xt:["Berries and herbs on ice.","Herbs with berries on ice."]},rs:{kt:[s.xs,s.ys],Xt:["I need something to calm me down.\nTo help me think straight again.","My fiery temper gets in my way"],get Os(){return[s.Qt.ls]}},fs:{kt:[s.xs,s.bs],Xt:["I have this mental fog..."]},ls:{kt:[s.xs,s.ps],Xt:["I had a really bad day...","Can you bottle the feeling of\nwrapping yourself in a blanket?"],get Os(){return[s.Qt.fs,s.Qt.cs]}},cs:{kt:[s.xs,s.bs,s.ps],Xt:["Warm and healing, but,\nlike, for the head"],get Os(){return[s.Qt.ls]}},ds:{kt:[s.xs,s.ys,s.ps],Xt:["My emotions feel so... flat.\nGive me some swings.","Give me conflicting feelings.\nYou heard me."]},us:{kt:[s.xs,s.ys,s.ps,s.bs],Xt:["Make it a hotpot: Throw\na bit of everything in.","Make it shimmer in all\nthe colors you can!"]}};